"use strict";
//********************************************************************
// BingMaps v8
// BmapQuery: v0.9.7 ( https://mapapi.org/indexb.php )
// Auther:Daisuke.Yamazaki
// MIT License.
//********************************************************************
"use strict";function _instanceof(e,o){return null!=o&&"undefined"!=typeof Symbol&&o[Symbol.hasInstance]?!!o[Symbol.hasInstance](e):e instanceof o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,o){if(!_instanceof(e,o))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,o){for(var t=0;t<o.length;t++){var a=o[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,o,t){return o&&_defineProperties(e.prototype,o),t&&_defineProperties(e,t),e}var Bmap=function(){function Bmap(e){_classCallCheck(this,Bmap),this.target=e,this.map=null,this.directionsManager=null,this.loc,this.layer=new Microsoft.Maps.Layer,this.watchId,this.tracker=[],this.speed=[]}return _createClass(Bmap,[{key:"startMap",value:function startMap(lat,lon,typeid,size){if(""==this.target||""==lat||""==lon||""==typeid||""==size)return!1;this.map=new Microsoft.Maps.Map(this.target,{center:new Microsoft.Maps.Location(lat,lon),mapTypeId:eval("Microsoft.Maps.MapTypeId."+typeid),zoom:size})}},{key:"setLocation",value:function(e,o){return new Microsoft.Maps.Location(e,o)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"getLat",value:function(){return this.map.getCenter().latitude}},{key:"getLon",value:function(){return this.map.getCenter().longitude}},{key:"changeMap",value:function changeMap(lat,lon,id,num){if(""==this.map||""==lat||""==lon||""==id||""==num)return!1;var loc=new Microsoft.Maps.Location(lat,lon);this.map.setView({mapTypeId:eval("Microsoft.Maps.MapTypeId."+id),center:loc,zoom:num,bounds:loc.bestView})}},{key:"onMap",value:function(e,o){if("object"!=_typeof(this.map)||""==e||"function"!=typeof o)return!1;"viewchangestart"==e&&Microsoft.Maps.Events.addHandler(this.map,"viewchangestart",o),"viewchange"==e&&Microsoft.Maps.Events.addHandler(this.map,"viewchange",o),"viewchangeend"==e&&Microsoft.Maps.Events.addHandler(this.map,"viewchangeend",o),"click"==e&&Microsoft.Maps.Events.addHandler(this.map,"click",o),"dblclick"==e&&Microsoft.Maps.Events.addHandler(this.map,"dblclick",o),"rightclick"==e&&Microsoft.Maps.Events.addHandler(this.map,"rightclick",o),"mousedown"==e&&Microsoft.Maps.Events.addHandler(this.map,"mousedown",o),"mouseout"==e&&Microsoft.Maps.Events.addHandler(this.map,"mouseout",o),"mouseover"==e&&Microsoft.Maps.Events.addHandler(this.map,"mouseover",o),"mouseup"==e&&Microsoft.Maps.Events.addHandler(this.map,"mouseup",o),"mousewheel"==e&&Microsoft.Maps.Events.addHandler(this.map,"mousewheel",o),"maptypechanged"==e&&Microsoft.Maps.Events.addHandler(this.map,"maptypechanged",o)}},{key:"pin",value:function(e,o,t){var a,i,s,n;if(""==this.map||""==e||""==o||""==t)return!1;a=void 0!==arguments[3]&&0!=arguments[3],i=void 0!==arguments[4]&&0!=arguments[4],s=void 0!==arguments[5]&&0!=arguments[5],n=void 0===arguments[6]||1==arguments[6];var r=new Microsoft.Maps.Location(e,o),c=new Microsoft.Maps.Pushpin(r,{color:t,draggable:a,enableClickedStyle:i,enableHoverStyle:s,visible:n});return this.map.entities.push(c),c}},{key:"onPin",value:function(e,o,t){if("object"!==_typeof(e)||""===o||"function"!=typeof t)return!1;"click"==o&&Microsoft.Maps.Events.addHandler(e,"click",t),"mousedown"==o&&Microsoft.Maps.Events.addHandler(e,"mousedown",t),"mouseout"==o&&Microsoft.Maps.Events.addHandler(e,"mouseout",t),"mouseover"==o&&Microsoft.Maps.Events.addHandler(e,"mouseover",t),"mouseup"==o&&Microsoft.Maps.Events.addHandler(e,"mouseup",t)}},{key:"deletePin",value:function(){for(var e=this.map,o=e.entities.getLength()-1;o>=0;o--){_instanceof(e.entities.get(o),Microsoft.Maps.Pushpin)&&e.entities.removeAt(o)}}},{key:"pinText",value:function(e,o,t,a,i){if(""==this.map||""==e||""==o||""==t||""==a||""==i)return!1;var s=new Microsoft.Maps.Location(e,o),n=new Microsoft.Maps.Pushpin(s,{title:t,subTitle:a,text:i});return this.map.entities.push(n),n}},{key:"pinIcon",value:function(e,o,t,a,i,s){if(""==this.map||""==e||""==o||""==t||""==a)return!1;var n=this.map,r=new Microsoft.Maps.Location(e,o);this._createScaledPushpin(r,t,a,i,s,function(e){return n.entities.push(e),e})}},{key:"pinLayer",value:function(e,o,t){var a,i,s,n,r=this.map;if(""==this.map||""==e||""==o||""==t)return!1;a=void 0!==arguments[3]&&0!=arguments[3],i=void 0!==arguments[4]&&0!=arguments[4],s=void 0!==arguments[5]&&0!=arguments[5],n=void 0===arguments[6]||1==arguments[6];var c=new Microsoft.Maps.Location(e,o),l=new Microsoft.Maps.Pushpin(c,{color:t,draggable:a,enableClickedStyle:i,enableHoverStyle:s,visible:n});return this.layer.add(l),r.layers.insert(this.layer),l}},{key:"infoboxLayers",value:function(e,o){var t=this.map,a=[],i=[],s=[];if(""==t||"object"!==_typeof(e)||0===e.length)return!1;for(var n=function(n){var r=new Microsoft.Maps.Location(e[n].lat,e[n].lon);a[n]=new Microsoft.Maps.Layer,a[n].metadata={zoomRange:{min:1,max:20}},i[n]=new Microsoft.Maps.Pushpin(r,{color:e[n].pinColor}),a[n].add(i[n]),s[n]=new Microsoft.Maps.Infobox(r,{maxHeight:e[n].height,maxWidth:e[n].width,title:e[n].title,description:e[n].description,visible:e[n].show}),s[n].setMap(t),Microsoft.Maps.Events.addHandler(i[n],"click",function(){if(!0===o)for(var e=0;e<s.length;e++)s[e].setOptions({visible:!1});s[n].setOptions({visible:!0}),s[n].setMap(t)}),t.layers.insert(a[n])},r=0;r<e.length;r++)n(r)}},{key:"pinLayerClear",value:function(){void 0===arguments[0]?this.layer.clear():this.layer.remove(arguments[0])}},{key:"polyline",value:function(e,o,t){var a={strokeColor:o,strokeThickness:t,strokeDashArray:"object"==_typeof(arguments[3])?arguments[3]:[]},i=new Microsoft.Maps.Polyline(e,a);this.map.entities.push(i)}},{key:"_createScaledPushpin",value:function(e,o,t,a,i,s){var n=new Image;n.onload=function(){var o=document.createElement("canvas");o.width=n.width*t,o.height=n.height*t,o.getContext("2d").drawImage(n,0,0,o.width,o.height);var r=new Microsoft.Maps.Pushpin(e,{icon:o.toDataURL(),anchor:new Microsoft.Maps.Point(a,i)});s&&s(r)},n.src=o}},{key:"infobox",value:function(e,o,t,a){if(""==this.map||""==e||""==o||""==t||""==a)return!1;var i=new Microsoft.Maps.Location(e,o),s=new Microsoft.Maps.Infobox(i,{title:t,description:a});s.setMap(this.map)}},{key:"infoboxHtml",value:function(e,o,t){if(""==this.map||""==e||""==o||""==t)return!1;var a=new Microsoft.Maps.Location(e,o);new Microsoft.Maps.Infobox(a,{htmlContent:t}).setMap(this.map)}},{key:"infoboxIframe",value:function(e,o,t,a,i,s){new Microsoft.Maps.Infobox(this.setLocation(e,o),{maxHeight:t,maxWidth:a,title:i,description:s}).setMap(this.map)}},{key:"onInfobox",value:function(e,o,t,a,i){var s=this.setLocation(e,o);new Microsoft.Maps.Infobox(s,{maxHeight:this.map.getHeight()-50,maxWidth:this.map.getWidth()-50,title:t,description:a,actions:i}).setMap(this.map)}},{key:"getGeocode",value:async function(e,o){o(await this._geocodeQuery(e))}},{key:"_geocodeQuery",value:function(e){var o=this.map;return new Promise(function(t){var a;Microsoft.Maps.loadModule("Microsoft.Maps.Search",function(){(a=new Microsoft.Maps.Search.SearchManager(o))&&a.geocode({where:e,callback:function(e){if(e&&e.results&&e.results.length>0){var a=new Microsoft.Maps.Pushpin(e.results[0].location);return o.entities.push(a),o.setView({bounds:e.results[0].bestView}),t(e.results[0].location)}},errorCallback:function(e){return t(!1)}})})})}},{key:"reverseGeocode",value:async function(e,o){o(await this._reverseGeocode(e))}},{key:"_reverseGeocode",value:function(e){var o=this.map;return new Promise(function(t){var a;if(!a){var i={location:e,callback:function(e){return t(e.name)},errorCallback:function(e){return t("Unable to reverse geocode location.")}};Microsoft.Maps.loadModule("Microsoft.Maps.Search",function(){(a=new Microsoft.Maps.Search.SearchManager(o)).reverseGeocode(i)})}})}},{key:"onGeocode",value:function(e,o){(""!==e&&"string"==typeof e||"function"!=typeof o)&&Microsoft.Maps.Events.addHandler(this.map,e,o)}},{key:"direction",value:function(e,o,t,a){var i,s=this.map,n=arguments[4];Microsoft.Maps.loadModule("Microsoft.Maps.Directions",function(){i=new Microsoft.Maps.Directions.DirectionsManager(s),"walking"==o?i.setRequestOptions({routeMode:Microsoft.Maps.Directions.RouteMode.walking}):i.setRequestOptions({routeMode:Microsoft.Maps.Directions.RouteMode.driving});var r=new Microsoft.Maps.Directions.Waypoint({address:t});i.addWaypoint(r),void 0!==n&&n.forEach(function(e){var o=new Microsoft.Maps.Directions.Waypoint({address:e});i.addWaypoint(o)});var c=new Microsoft.Maps.Directions.Waypoint({address:a});i.addWaypoint(c),i.setRenderOptions({itineraryContainer:e}),Microsoft.Maps.Events.addHandler(i,"directionsError",function(e){alert("Error: "+e.message+"\r\nResponse Code: "+e.responseCode)}),Microsoft.Maps.Events.addHandler(i,"directionsUpdated",function(e){var o=i.getRequestOptions().routeIndex;Math.round(100*e.routeSummary[o].distance);i.getRequestOptions().distanceUnit,Microsoft.Maps.Directions.DistanceUnit.km}),i.calculateDirections()})}},{key:"selectedSuggestion",value:function(e,o){var t=this.map;Microsoft.Maps.loadModule("Microsoft.Maps.AutoSuggest",function(){new Microsoft.Maps.AutosuggestManager({map:t}).attachAutosuggest(e,o,function(e){t.entities.clear(),t.entities.push(new Microsoft.Maps.Pushpin(e.location)),t.setView({bounds:e.bestView})})})}},{key:"traffic",value:function(){var e=this.map;Microsoft.Maps.loadModule("Microsoft.Maps.Traffic",function(){new Microsoft.Maps.Traffic.TrafficManager(e).show()})}},{key:"getBoundary",value:function(e){var o=this.map,t={entityType:e};Microsoft.Maps.loadModule("Microsoft.Maps.SpatialDataService",function(){Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getBoundary(o.getCenter(),t,o,function(e){e.results&&e.results.length>0&&o.entities.push(e.results[0].Polygons)},null,function(e,o){console.log(e),console.log(o)})})}},{key:"getMultiBoundary",value:function(e){var o=this.map,t={entityType:"Postcode1"};Microsoft.Maps.loadModule("Microsoft.Maps.SpatialDataService",function(){Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getBoundary(e,t,o,function(e){e.results&&e.results.length>0&&o.entities.push(e.results[0].Polygons)},null,function(e,o,t){console.log(e),console.log(o),console.log(t)})})}},{key:"getSearchBoundary",value:function(e,o){var t=this.map;Microsoft.Maps.loadModule(["Microsoft.Maps.SpatialDataService","Microsoft.Maps.Search"],function(){var a=new Microsoft.Maps.Search.SearchManager(t),i={where:e,callback:function(e){if(e&&e.results&&e.results.length>0){t.setView({bounds:e.results[0].bestView});var a={entityType:o,getAllPolygons:!0};Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getBoundary(e.results[0].location,a,t,function(e){e.results&&e.results.length>0&&t.entities.push(e.results[0].Polygons)},null,function(e,o){console.log(e),console.log(o)})}}};a.geocode(i)})}},{key:"startTracking",value:function(e){var o=this.map,t=this.tracker,a=this.speed,i=new Microsoft.Maps.Pushpin(o.getCenter(),{visible:!1});o.entities.push(i),this.watchId=navigator.geolocation.watchPosition(function(s){var n=new Microsoft.Maps.Location(s.coords.latitude,s.coords.longitude);i.setLocation(n),i.setOptions({visible:!0}),o.setView({center:n}),!0===e&&console.log(n),t.push(n),a.push(s.coords.speed)})}},{key:"stopTracking",value:function(){navigator.geolocation.clearWatch(this.watchId),this.map.entities.clear()}},{key:"startTrackingDraw",value:function(e,o){var t,a=this.map,i=this.tracker,s=this.speed,n=!1,r="",c=0;void 0!==arguments[2]&&""!=arguments[2]&&(r=arguments[2]),void 0!==arguments[3]&&1==arguments[3]&&(n=!0),0===c&&navigator.geolocation.getCurrentPosition(function(e){var o=new Microsoft.Maps.Location(e.coords.latitude,e.coords.longitude);t=new Microsoft.Maps.Pushpin(o,{visible:!0}),a.entities.push(t)}),this.watchId=navigator.geolocation.watchPosition(function(l){var u=new Microsoft.Maps.Location(l.coords.latitude,l.coords.longitude);t.setLocation(u),a.setView({center:u}),i.push(u),s.push(l.coords.speed);var p={strokeColor:e,strokeThickness:o};a.entities.push(new Microsoft.Maps.Polyline(i,p)),1==n&&(console.log(i),console.log(s)),""!=r&&null!=l.coords.speed&&(document.querySelector(r).innerHTML=l.coords.speed),c++})}},{key:"stopTrackingDraw",value:function(){navigator.geolocation.clearWatch(this.watchId)}},{key:"clearMap",value:function(){this.map.entities.clear()}},{key:"getTrackingData",value:function(){return this.tracker}},{key:"getTrackingSpeed",value:function(){return this.speed}},{key:"clearTrackingData",value:function(){this.tracker=[],this.speed=[]}},{key:"circle",value:function(e,o){var t=this.map,a=arguments[2],i=arguments[3];Microsoft.Maps.loadModule("Microsoft.Maps.SpatialMath",function(){navigator.geolocation.getCurrentPosition(function(s){var n=new Microsoft.Maps.Location(s.coords.latitude,s.coords.longitude);t.setView({center:n});var r=Microsoft.Maps.SpatialMath.getRegularPolygon(n,e,36,Microsoft.Maps.SpatialMath.Meters),c=new Microsoft.Maps.Polygon(r,{fillColor:void 0===o.fillColor?"rgba(255,0,0,0.3)":o.fillColor,strokeThickness:void 0===o.strokeWidth?0:o.strokeWidth});t.entities.push(c),"click"!==a&&"mousedown"!==a&&"mouseout"!==a&&"mouseover"!==a&&"mouseup"!==a||"function"!=typeof i||Microsoft.Maps.Events.addHandler(c,a,i);var l=new Microsoft.Maps.Pushpin(n,{color:void 0===o.pinColor?"#ff0000":o.pinColor});t.entities.push(l)})})}},{key:"circleSet",value:function(e,o,t,a){var i=this.map,s=arguments[4],n=arguments[5];Microsoft.Maps.loadModule("Microsoft.Maps.SpatialMath",function(){var r=new Microsoft.Maps.Location(e,o),c=Microsoft.Maps.SpatialMath.getRegularPolygon(r,t,36,Microsoft.Maps.SpatialMath.Meters),l=new Microsoft.Maps.Polygon(c,{fillColor:void 0===a.fillColor?"rgba(255,0,0,0.3)":a.fillColor,strokeThickness:void 0===a.strokeWidth?0:a.strokeWidth});i.entities.push(l),"click"!==s&&"mousedown"!==s&&"mouseout"!==s&&"mouseover"!==s&&"mouseup"!==s||"function"!=typeof n||Microsoft.Maps.Events.addHandler(l,s,n);var u=new Microsoft.Maps.Pushpin(r,{color:void 0===a.pinColor?"#ff0000":a.pinColor});i.entities.push(u)})}},{key:"setLocationBoundary",value:function(e,o,t){var a=this.map,i=[],s=void 0!==arguments[3]&&1==arguments[3];function n(){for(var e,o=a.getZoom(),t=0;t<a.layers.length;t++)(e=a.layers[t]).metadata&&e.metadata.zoomRange&&(o>=e.metadata.zoomRange.min&&o<=e.metadata.zoomRange.max?e.setVisible(!0):e.setVisible(!1))}console.log(s),Microsoft.Maps.loadModule(["Microsoft.Maps.SpatialDataService","Microsoft.Maps.Search"],function(){for(var n=new Microsoft.Maps.Search.SearchManager(a),r=0;r<e.length;r++)n.geocode(c(r,o[r]));function c(o,n){return{where:e[o],callback:function(e){if(e&&e.results&&e.results.length>0){var r={entityType:t,getAllPolygons:s};Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getBoundary(e.results[0].location,r,a,function(e){e.results&&e.results.length>0&&(i[o]=new Microsoft.Maps.Layer,i[o].metadata=void 0===n?{zoomRange:{min:1,max:20}}:{zoomRange:{min:n[0],max:n[1]}},i[o].add(e.results[0].Polygons),a.layers.insert(i[o]))},null,function(e,o){console.log(e),console.log(o)})}}}}}),Microsoft.Maps.Events.addHandler(a,"viewchangeend",n),n()}},{key:"heatMap",value:function(e){var o=this.map;Microsoft.Maps.loadModule(["Microsoft.Maps.GeoJson","Microsoft.Maps.HeatMap"],function(){Microsoft.Maps.GeoJson.readFromUrl(e,function(e){var t=new Microsoft.Maps.HeatMapLayer(e,{radius:5,propertyAsWeight:"mag"});o.layers.insert(t)})})}}]),Bmap}();